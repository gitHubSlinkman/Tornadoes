---
title: "Reading monthy US tornado data"
author: "Craig W. Slinkman"
date: "6/10/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Instruction  

This document is used to development of the Inited States tonado data.

## Preperation

```{r}
library( tidyverse )
library( stringr )
library( lubridate )
```

## Load functions

```{r}
 source('D:/R-Projects/Tornadoes/functions/get_file_names.R')
 source('D:/R-Projects/Tornadoes/functions/get_file.R')
```

## Get wording directory

```{r}
wd <- getwd()
```



## Get list of monthly data files

```{r}
files <- get_file_names()
files
```

## Read month files into the months list.

```{r}
nf <- length( files )
months <- list()

 
for( i in 1:nf ){
  fp <- file.path( wd, 
                  "data",
                  files[i] )
           
 month  <- read_csv( fp,
                     col_types = cols( .default           = col_double(), 
                                       CZ_NAME_STR        = col_character(),
                                       BEGIN_LOCATION     = col_character(),
                                       BEGIN_DATE         = col_character(),
                                       EVENT_TYPE         = col_character(),
                                       MAGNITUDE          = col_logical(),
                                       TOR_F_SCALE        = col_character(),
                                       STATE_ABBR         = col_character(),
                                       CZ_TIMEZONE        = col_character(),
                                       MAGNITUDE_TYPE     = col_logical(),
                                       CZ_TYPE            = col_character(),
                                       WFO                = col_character(),
                                       SOURCE             = col_character(),
                                       FLOOD_CAUSE        = col_logical(),
                                       BEGIN_AZIMUTH      = col_character(),
                                       END_AZIMUTH        = col_character(),
                                       END_LOCATION       = col_character(),
                                       END_DATE          = col_character(),
                                       EVENT_NARRATIVE   = col_character(),
                                       EPISODE_NARRATIVE = col_character()))
 month <- 
   month %>% 
    select( -EVENT_TYPE,
             EPISODE_NARRATIVE )  
 
 
 months[[length(months)+1]] <- month 

} 

months
```


## Bind all the tibbles in the months list into a single tibble

```{r}
tornadoes <- bind_rows( months )
tornadoes
```
## Change column names to lowercase to be compatible with tidyverse naming conventions

```{r}
names( tornadoes) <- tolower( names( tornadoes ))
tornadoes
```
## Create date event year and event month from begin_date \

```{r}
tornadoes <- 
  tornadoes %>% 
    mutate( date =parse_date_time(begin_date))
  
```

